<%- include('../partials/header') %>
  <div class="container">
  <section class="section">
    <div class="page-head">
      <h1>Projetos abertos</h1>
      <% if (user) { %><a href="/projetos/publicar" class="btn btn-primary">Publicar projeto</a><% } %>
    </div>
    <form class="filter-form" action="/projetos" method="get">
      <div class="filter-row">
        <input type="text" name="q" placeholder="Buscar (título ou descrição)" value="<%= searchQ || '' %>" class="filter-input">
        <select name="nivel" class="filter-select">
          <option value="">Qualquer nível</option>
          <option value="beginner" <%= searchLevel === 'beginner' ? 'selected' : '' %>>Iniciante</option>
          <option value="intermediate" <%= searchLevel === 'intermediate' ? 'selected' : '' %>>Intermediário</option>
          <option value="expert" <%= searchLevel === 'expert' ? 'selected' : '' %>>Expert</option>
        </select>
        <input type="number" name="orcamento_min" placeholder="Orç. mín." step="0.01" min="0" value="<%= searchBudgetMin != null ? searchBudgetMin : '' %>" class="filter-input filter-input-num">
        <input type="number" name="orcamento_max" placeholder="Orç. máx." step="0.01" min="0" value="<%= searchBudgetMax != null ? searchBudgetMax : '' %>" class="filter-input filter-input-num">
        <% if (currentCategory) { %><input type="hidden" name="categoria" value="<%= currentCategory %>"><% } %>
        <button type="submit" class="btn btn-primary">Filtrar</button>
      </div>
    </form>
    <% if (categories && categories.length) { %>
    <div class="filter-bar">
      <span class="filter-label">Categoria:</span>
      <a href="/projetos" class="filter-chip <%= !currentCategory ? 'active' : '' %>">Todas</a>
      <% categories.forEach(function(cat) { %>
      <a href="/projetos?categoria=<%= encodeURIComponent(cat) %>" class="filter-chip <%= currentCategory === cat ? 'active' : '' %>"><%= cat %></a>
      <% }); %>
    </div>
    <% } %>
    <% if (projects && projects.length) { %>
    <div class="projects-grid">
      <% projects.forEach(function(p) { %>
      <a href="/projetos/<%= p.id %>" class="project-card">
        <h3><%= p.title %></h3>
        <p class="excerpt"><%= (p.description || '').substring(0, 120) %>...</p>
        <div class="project-card-meta">
          <span class="tag"><%= p.category %></span>
          <span class="price">R$ <%= Number(p.budget).toLocaleString('pt-BR') %></span>
        </div>
        <small>Por <%= p.client_name %></small>
      </a>
      <% }); %>
    </div>
    <% } else { %>
    <p>Nenhum projeto aberto no momento. <% if (user) { %><a href="/projetos/publicar">Seja o primeiro a publicar</a>.<% } %></p>
    <% } %>
  </section>
  </div>
<%- include('../partials/footer') %>
